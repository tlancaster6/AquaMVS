---
phase: 08-user-guide-and-tutorials-overhaul
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/tutorial/notebook.ipynb
  - docs/tutorial/index.rst
autonomous: true

must_haves:
  truths:
    - "API notebook has Colab launch badge as first element"
    - "API notebook auto-downloads example dataset in first code cell with no manual step"
    - "All file paths in notebook are hardcoded to match published dataset structure"
    - "Tutorial index page serves as overview routing users to CLI vs API workflows"
    - "Notebook is committed with outputs cleared (will be re-executed and committed with outputs before RTD deploy)"
  artifacts:
    - path: "docs/tutorial/notebook.ipynb"
      provides: "Polished end-to-end API tutorial with Colab badge and auto-download"
    - path: "docs/tutorial/index.rst"
      provides: "Overview page routing CLI vs API users"
  key_links:
    - from: "docs/tutorial/index.rst"
      to: "docs/tutorial/notebook.ipynb"
      via: "toctree entry"
      pattern: "notebook"
    - from: "docs/tutorial/notebook.ipynb"
      to: "GitHub Releases"
      via: "urllib.request.urlretrieve in first code cell"
      pattern: "urlretrieve"
---

<objective>
Polish the API tutorial notebook with Colab support and auto-download, and rewrite the tutorial index as an overview page.

Purpose: Make the API notebook plug-and-play on Colab (zero setup) and give users a clear routing page to choose between CLI and API workflows.
Output: Updated notebook.ipynb with Colab badge + auto-download, rewritten tutorial/index.rst as overview
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-user-guide-and-tutorials-overhaul/08-RESEARCH.md
@docs/tutorial/notebook.ipynb
@docs/tutorial/index.rst
</context>

<tasks>

<task type="auto">
  <name>Task 1: Polish API notebook with Colab badge and auto-download</name>
  <files>docs/tutorial/notebook.ipynb</files>
  <action>
  Rewrite `docs/tutorial/notebook.ipynb` in place. Keep the same overall structure but make these changes:

  **Cell 0 (first markdown cell) — Replace entirely:**
  Add Colab launch badge as raw HTML at the top, followed by the tutorial title and introduction:
  ```html
  <a href="https://colab.research.google.com/github/tlancaster6/AquaMVS/blob/main/docs/tutorial/notebook.ipynb">
    <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
  </a>

  # End-to-End Reconstruction Tutorial

  This tutorial walks through a complete multi-view stereo reconstruction ...
  ```
  Remove the manual download instructions. The auto-download cell handles this.

  **Cell 1 (second markdown cell, prerequisites) — Replace entirely:**
  Replace the "Prerequisites" markdown with a Colab/local install cell. Make it a CODE cell:
  ```python
  # Install AquaMVS (run this cell in Colab; skip locally if already installed)
  import subprocess, sys
  try:
      import aquamvs
  except ImportError:
      subprocess.run([sys.executable, "-m", "pip", "install", "torch", "torchvision",
                      "--index-url", "https://download.pytorch.org/whl/cpu", "-q"], check=True)
      subprocess.run([sys.executable, "-m", "pip", "install",
                      "git+https://github.com/cvg/LightGlue.git@edb2b83",
                      "git+https://github.com/tlancaster6/RoMaV2.git",
                      "aquamvs", "-q"], check=True)
  ```

  **Cell 2 (new) — Auto-download example dataset (CODE cell):**
  ```python
  import os, urllib.request, zipfile
  from pathlib import Path

  DATASET_URL = "https://github.com/tlancaster6/AquaMVS/releases/download/v0.1.0-example-data/aquamvs-example-dataset.zip"
  DATASET_DIR = Path("aquamvs-example-dataset")

  if not DATASET_DIR.exists():
      print("Downloading example dataset...")
      urllib.request.urlretrieve(DATASET_URL, "aquamvs-example-dataset.zip")
      with zipfile.ZipFile("aquamvs-example-dataset.zip") as zf:
          zf.extractall()
      os.remove("aquamvs-example-dataset.zip")
      print("Done.")
  else:
      print(f"Dataset already present at {DATASET_DIR}")
  ```

  **Cell 3 (Setup and Imports) — Update paths:**
  Change `DATA_DIR = Path("example_data")` to use the auto-downloaded path:
  ```python
  from pathlib import Path
  import matplotlib.pyplot as plt
  import numpy as np
  from aquamvs import Pipeline, PipelineConfig

  CONFIG_PATH = Path("aquamvs-example-dataset") / "config.yaml"
  ```
  Remove the `FileNotFoundError` check (the auto-download handles this).

  **Depth map loading cell (cell 13 area):**
  Update the depth map path. Current code uses `output / f"{cam}_depth.npz"` but actual pipeline output structure is `output / "depth_maps" / f"{cam}.npz"`. Check the output directory layout from cli_guide.md and fix paths:
  - Depth maps: `output / "depth_maps" / f"{cam}.npz"`
  - Consistency maps: `output / "consistency_maps" / f"{cam}.npz"`
  - Point cloud: `output / "point_cloud" / "fused.ply"` (not `output / "fused.ply"`)
  - Mesh: `output / "mesh" / "surface.ply"` (not `output / "surface.ply"`)

  **Point cloud cell (cell 17 area):**
  Fix path to `output / "point_cloud" / "fused.ply"`.

  **Mesh cell (cell 20 area):**
  Fix path to `output / "mesh" / "surface.ply"`.

  **Next Steps cell (last markdown):**
  - Add link to troubleshooting: "If you encounter issues, see the [Troubleshooting Guide](../troubleshooting)."
  - Add link to benchmarking notebook: "To compare reconstruction pathways, see the [Benchmarking Tutorial](benchmark)."
  - Update quality preset tip: change `quality_preset: "fast"` to `aquamvs init --preset fast`.

  **General:**
  - Professional/academic tone throughout
  - All paths hardcoded (not configurable variables) per locked decision
  - Keep cell outputs CLEARED (no execution outputs in committed notebook — outputs will be added when the notebook is executed on real data before deployment)
  </action>
  <verify>
  - First cell of notebook contains "colab.research.google.com" badge HTML
  - A code cell contains "urllib.request.urlretrieve" for auto-download
  - No cell references `Path("example_data")` — all use `Path("aquamvs-example-dataset")`
  - `python -c "import json; nb=json.load(open('docs/tutorial/notebook.ipynb')); print(nb['cells'][0]['source'][0])"` shows the Colab badge
  - No mention of `quality_preset:` as a YAML key
  </verify>
  <done>API notebook has Colab badge, auto-installs AquaMVS, auto-downloads dataset, uses correct output paths, links to troubleshooting and benchmarking</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite tutorial index as overview page</name>
  <files>docs/tutorial/index.rst</files>
  <action>
  Replace `docs/tutorial/index.rst` with a proper overview page that routes users to the right workflow. Per research recommendation, fold the overview into this file (no standalone overview page).

  New structure:
  ```rst
  Tutorials
  =========

  AquaMVS provides two ways to run reconstruction: a command-line interface (CLI) for
  batch processing and scripted workflows, and a Python API for programmatic control
  and integration into custom pipelines.

  Choose Your Workflow
  --------------------

  **Command-Line Interface (CLI)**
     Best for: Running reconstructions on new datasets, batch processing, quick experiments.
     Start with the :doc:`CLI Guide </cli_guide>`.

     .. code-block:: bash

        aquamvs init --input-dir ./videos --calibration calibration.json --output-dir ./output
        aquamvs run config.yaml

  **Python API**
     Best for: Custom workflows, programmatic access, integration with other tools.
     Start with the :doc:`End-to-End Tutorial <notebook>`.

     .. code-block:: python

        from aquamvs import Pipeline, PipelineConfig
        config = PipelineConfig.from_yaml("config.yaml")
        Pipeline(config).run()

  **Benchmarking**
     Compare LightGlue and RoMa reconstruction pathways with timing and quality metrics.
     See the :doc:`Benchmarking Tutorial <benchmark>`.

  .. toctree::
     :maxdepth: 2
     :hidden:

     notebook
     benchmark
  ```

  Notes:
  - The `:hidden:` toctree ensures notebook and benchmark appear in navigation without duplicating the descriptions
  - The benchmark entry points to `benchmark` which will be `benchmark.ipynb` (created in Plan 03). This is a forward reference — Sphinx will warn until Plan 03 creates the file, but the toctree is correct.
  - CLI guide is NOT in this toctree (it's in the parent index.rst under "User Guide")
  - Professional/academic tone
  </action>
  <verify>
  - `docs/tutorial/index.rst` contains "Choose Your Workflow"
  - `docs/tutorial/index.rst` contains toctree entries for `notebook` and `benchmark`
  - `docs/tutorial/index.rst` contains cross-references to both CLI guide and API notebook
  - No `:download:` directive remains (old pattern removed)
  </verify>
  <done>Tutorial index is a proper overview page routing users to CLI guide, API notebook, and benchmarking notebook with quick-start snippets for each</done>
</task>

</tasks>

<verification>
- Notebook JSON is valid: `python -c "import json; json.load(open('docs/tutorial/notebook.ipynb'))"`
- Tutorial index renders: check RST syntax is valid
- No references to old `example_data` path in notebook
- Colab badge URL is correct: `https://colab.research.google.com/github/tlancaster6/AquaMVS/blob/main/docs/tutorial/notebook.ipynb`
</verification>

<success_criteria>
API notebook is Colab-ready with auto-download and correct output paths. Tutorial index serves as an overview page routing users to CLI, API, and benchmarking workflows.
</success_criteria>

<output>
After completion, create `.planning/phases/08-user-guide-and-tutorials-overhaul/08-02-SUMMARY.md`
</output>
