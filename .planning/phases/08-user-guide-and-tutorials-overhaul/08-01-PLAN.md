---
phase: 08-user-guide-and-tutorials-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/conf.py
  - pyproject.toml
  - docs/cli_guide.md
  - docs/troubleshooting.rst
autonomous: true

must_haves:
  truths:
    - "myst-nb is configured in Sphinx conf.py with nb_execution_mode off"
    - "CLI guide accurately documents all Phase 7 changes (benchmark rebuild, init --preset, --output-fps, removed deprecated keys)"
    - "CLI guide does not mention aquamvs profile, benchmark YAML configs, or quality_preset as a runtime YAML key"
    - "Centralized troubleshooting page exists and covers CLI, notebook, and Colab issues"
    - "myst-nb and nbformat are listed in pyproject.toml dev dependencies"
  artifacts:
    - path: "docs/conf.py"
      provides: "myst-nb extension config with nb_execution_mode off"
      contains: "myst_nb"
    - path: "docs/troubleshooting.rst"
      provides: "Centralized troubleshooting section"
    - path: "docs/cli_guide.md"
      provides: "Updated CLI guide reflecting Phase 7 changes"
    - path: "pyproject.toml"
      provides: "myst-nb and nbformat in dev dependencies"
      contains: "myst-nb"
  key_links:
    - from: "docs/cli_guide.md"
      to: "docs/troubleshooting.rst"
      via: "cross-reference link"
      pattern: "troubleshooting"
---

<objective>
Set up myst-nb infrastructure for notebook rendering on RTD and polish the CLI guide and troubleshooting docs.

Purpose: Enable Jupyter notebooks to render inline on ReadTheDocs with pre-executed static outputs, and ensure the CLI guide accurately reflects the current (Phase 7) command surface.
Output: Updated conf.py with myst-nb, updated pyproject.toml, polished CLI guide, new troubleshooting.rst
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-user-guide-and-tutorials-overhaul/08-RESEARCH.md
@docs/conf.py
@docs/cli_guide.md
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure myst-nb infrastructure and troubleshooting page</name>
  <files>docs/conf.py, pyproject.toml, docs/troubleshooting.rst</files>
  <action>
  **docs/conf.py:**
  - Replace `"myst_parser"` with `"myst_nb"` in the extensions list. Do NOT keep both (causes registration warning).
  - Add `nb_execution_mode = "off"` after the extensions list — RTD must not re-execute notebooks.
  - Update `source_suffix` dict: change `".md": "markdown"` to `".md": "myst-markdown"` and add `".ipynb": "myst-nb"`.

  **pyproject.toml:**
  - In `[project.optional-dependencies] dev`, replace `"myst-parser"` with `"myst-nb"`.
  - Add `"nbformat"` to the dev list (needed for smoke test in Plan 03).

  **docs/troubleshooting.rst:**
  - Create a new centralized troubleshooting page with these sections:
    1. **Installation Issues** — PyTorch not found, LightGlue/RoMa import errors, CUDA version mismatch
    2. **Pipeline Errors** — No cameras matched (regex pattern issue), CUDA OOM (reduce resolution/hypotheses or use CPU), depth maps mostly NaN (check depth range), empty point cloud after fusion
    3. **Notebook Issues** — ModuleNotFoundError in Colab (need pip install cell), dataset download fails (check URL/network), Open3D visualization fails headless (use OffscreenRenderer fallback)
    4. **Configuration Issues** — Deprecated keys warning (save_depth_maps etc. removed), quality_preset in YAML (use `init --preset` instead)
  - Professional/academic tone. Each issue as a definition-list entry with Problem / Solution format.
  </action>
  <verify>
  - `python -c "import myst_nb"` succeeds (after `pip install -e '.[dev]'`)
  - `grep -c "myst_nb" docs/conf.py` returns 2 (extension + source_suffix)
  - `grep "nb_execution_mode" docs/conf.py` shows `"off"`
  - `docs/troubleshooting.rst` exists and contains "Installation Issues", "Pipeline Errors", "Notebook Issues"
  - `grep "myst-nb" pyproject.toml` finds the dependency
  </verify>
  <done>Sphinx conf.py uses myst-nb with execution off, pyproject.toml has myst-nb+nbformat, troubleshooting.rst covers all common issues</done>
</task>

<task type="auto">
  <name>Task 2: Polish CLI guide for Phase 7 changes and link to troubleshooting</name>
  <files>docs/cli_guide.md</files>
  <action>
  Systematically update `docs/cli_guide.md` for all Phase 7 changes. The current guide has several outdated sections.

  **Section: "Quality vs. Speed" (around line 308-322):**
  - REMOVE the `quality_preset:` YAML key example entirely. This runtime key is removed.
  - Replace with documentation of `aquamvs init --preset`:
    ```
    Use a quality preset when generating your configuration:
    ```bash
    aquamvs init --input-dir ... --preset fast      # Fewer depth planes, larger batches
    aquamvs init --input-dir ... --preset balanced   # Default tradeoffs
    aquamvs init --input-dir ... --preset quality    # Maximum depth planes, best accuracy
    ```
    The preset bakes optimized values directly into the generated `config.yaml`.
    ```
  - Keep the manual `num_depth_hypotheses` / `depth_batch_size` tuning below it.

  **Section: "Step 2: Generate Configuration" (around line 57-94):**
  - Add `--preset` to the parameter list: `--preset`: (Optional) Quality preset (`fast`, `balanced`, `quality`). Bakes optimized parameters into the generated config. Default: `balanced`.

  **Section: "Benchmarking" (around line 360-368):**
  - Rewrite completely. The current text is too vague. New content:
    ```
    ## Benchmarking

    Compare LightGlue and RoMa reconstruction pathways on a single frame:

    ```bash
    aquamvs benchmark config.yaml --frame 0
    ```

    This runs 4 pathway variants (LightGlue sparse, LightGlue full, RoMa sparse, RoMa full) and prints a comparison table with timing, point count, and cloud density for each.

    **Optional flags:**

    - `--extractors lightglue roma`: Run only specific extractors (default: all)
    - `--with-clahe`: Enable CLAHE preprocessing for all pathways

    Results are printed to the console as a formatted table. For detailed analysis with visualizations, see the [Benchmarking Tutorial](tutorial/benchmark).
    ```

  **Section: "Temporal Filtering" (around line 372-386):**
  - Add `--output-fps` to the parameter list: `--output-fps`: (Optional) Target output frame rate. Overrides automatic FPS detection (useful when source video metadata is unreliable).
  - The command name is `temporal-filter` (verify this matches current CLI).

  **Section: "Output Control" (around line 349-358):**
  - Remove any mention of `save_depth_maps`, `save_point_cloud`, or `save_mesh` config keys. These are REMOVED in Phase 7. Depth maps, point clouds, and meshes are now always saved.
  - The current text already says "Depth maps, point clouds, and meshes are always saved" which is correct. Just make sure no deprecated keys appear anywhere.

  **Section: "Troubleshooting" (bottom of file):**
  - Replace the entire troubleshooting section with a short redirect:
    ```
    ## Troubleshooting

    See the [Troubleshooting Guide](troubleshooting) for solutions to common issues with installation, pipeline errors, and configuration.
    ```

  **Tone:** Professional/academic throughout. Remove any overly casual phrasing.
  </action>
  <verify>
  - `grep -c "quality_preset:" docs/cli_guide.md` returns 0 (no runtime YAML key)
  - `grep -c "aquamvs profile" docs/cli_guide.md` returns 0 (removed command)
  - `grep "init --preset" docs/cli_guide.md` finds the new documentation
  - `grep "output-fps" docs/cli_guide.md` finds the new flag
  - `grep "troubleshooting" docs/cli_guide.md` finds the redirect link
  - `grep -c "save_depth_maps\|save_point_cloud\|save_mesh" docs/cli_guide.md` returns 0
  </verify>
  <done>CLI guide accurately reflects Phase 7 command surface: init --preset, unified benchmark with --extractors/--with-clahe, --output-fps on temporal-filter, no deprecated keys, troubleshooting redirects to centralized page</done>
</task>

</tasks>

<verification>
- `pip install -e ".[dev]"` succeeds with myst-nb
- `sphinx-build -W -b html docs/ docs/_build/html` completes without warnings about myst_parser/myst_nb conflict
- CLI guide contains no references to removed Phase 7 features (profile command, benchmark YAML config, quality_preset runtime key, save_depth_maps/save_point_cloud/save_mesh)
- Troubleshooting page renders in Sphinx build
</verification>

<success_criteria>
myst-nb infrastructure is configured for notebook rendering. CLI guide is fully updated for Phase 7 changes. Centralized troubleshooting page exists and is linked from CLI guide.
</success_criteria>

<output>
After completion, create `.planning/phases/08-user-guide-and-tutorials-overhaul/08-01-SUMMARY.md`
</output>
