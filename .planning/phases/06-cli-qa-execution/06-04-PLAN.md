---
phase: 06-cli-qa-execution
plan: 04
type: execute
wave: 4
depends_on: ["06-02"]
files_modified:
  - .planning/qa/issues-found.md
autonomous: false

must_haves:
  truths:
    - "aquamvs export-mesh converts PLY to OBJ, STL, and GLTF formats successfully"
    - "Mesh simplification via --simplify flag reduces triangle count to target"
    - "All exported mesh files are loadable in standard 3D viewers"
  artifacts:
    - path: "exported mesh files"
      provides: "OBJ, STL, GLTF versions of reconstruction mesh + simplified variant"
  key_links:
    - from: "aquamvs export-mesh"
      to: "output mesh files"
      via: "Open3D mesh I/O with format conversion and simplification"
---

<objective>
QA the `aquamvs export-mesh` command by converting reconstruction meshes to all supported formats (OBJ, STL, GLTF) and testing mesh simplification.

Purpose: Verify mesh export and simplification work with real reconstruction output.
Output: Meshes in all supported formats, with at least one simplified variant.
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-cli-qa-execution/06-02-SUMMARY.md
@src/aquamvs/cli.py
@src/aquamvs/surface.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Export mesh to all formats with simplification</name>
  <files>.planning/qa/issues-found.md</files>
  <action>
Test all mesh export formats and simplification using a real reconstruction mesh from Plan 02.

**Step 1: Locate input mesh**
- Find a PLY mesh from the LightGlue run: `ls output/frame_000000/mesh_*.ply`
- Get triangle count: `python -c "import open3d as o3d; m = o3d.io.read_triangle_mesh('output/frame_000000/mesh_frame_000000.ply'); print(len(m.triangles), 'triangles')"`

**Step 2: Export to OBJ**
- Run: `aquamvs export-mesh output/frame_000000/mesh_frame_000000.ply --format obj`
- Verify: output/frame_000000/mesh_frame_000000.obj exists and is non-zero

**Step 3: Export to STL**
- Run: `aquamvs export-mesh output/frame_000000/mesh_frame_000000.ply --format stl`
- Verify: output/frame_000000/mesh_frame_000000.stl exists and is non-zero

**Step 4: Export to GLTF with simplification**
- Choose a target face count that's roughly 50% of original (or 50000, whichever is smaller)
- Run: `aquamvs export-mesh output/frame_000000/mesh_frame_000000.ply --format gltf --simplify TARGET`
- Verify: output/frame_000000/mesh_frame_000000.gltf exists
- Check simplified triangle count: `python -c "import open3d as o3d; m = o3d.io.read_triangle_mesh('output/frame_000000/mesh_frame_000000.gltf'); print(len(m.triangles), 'triangles')"`
- Verify triangle count is approximately the target (simplification is approximate)

**Step 5: Test batch mode (optional if time allows)**
- If multiple PLY meshes exist: `aquamvs export-mesh --input-dir output/frame_000000/ --format obj`

**Step 6: Log issues**
- Append any non-blocking issues to .planning/qa/issues-found.md
  </action>
  <verify>
- OBJ, STL, GLTF files exist and are non-zero size
- Simplified GLTF has fewer triangles than original PLY
- All commands exit with code 0
  </verify>
  <done>export-mesh converts PLY to OBJ, STL, GLTF successfully, and --simplify reduces triangle count</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: User reviews exported meshes</name>
  <action>
Present exported meshes for user review:
1. OBJ — standard exchange format
2. STL — 3D printing format (normals auto-computed)
3. GLTF — web/viewer format with simplification applied

User should verify:
1. Open the OBJ file in MeshLab or another 3D viewer — verify surface looks correct, normals point outward
2. Open the STL file — verify it's a valid solid (no holes, correct normals)
3. Open the GLTF file — verify simplification didn't destroy surface shape, reduced triangle count is visible
4. Compare file sizes: STL should be largest (binary triangles), GLTF smallest (simplified)

Resume signal: Type "approved" if all mesh formats look correct, or describe issues.
  </action>
  <verify>User confirms all three mesh formats are valid and visually correct</verify>
  <done>User has reviewed OBJ, STL, and GLTF mesh exports</done>
</task>

</tasks>

<verification>
- All three format exports succeed
- Simplification produces visually similar mesh with fewer triangles
- Exported files are loadable in standard viewers
</verification>

<success_criteria>
- OBJ, STL, GLTF exports complete without errors
- --simplify flag produces mesh with approximately target triangle count
- User confirms exported meshes look correct in viewer
</success_criteria>

<output>
After completion, create `.planning/phases/06-cli-qa-execution/06-04-SUMMARY.md`
</output>
