---
phase: 04-documentation-and-examples
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/conf.py
  - docs/index.rst
  - docs/installation.rst
  - .readthedocs.yaml
  - pyproject.toml
autonomous: true

must_haves:
  truths:
    - "Sphinx builds locally with Furo theme without warnings"
    - "ReadTheDocs configuration file exists and references correct Python/Sphinx setup"
    - "Installation guide covers Windows, Linux, CPU-only, and GPU configurations"
  artifacts:
    - path: "docs/conf.py"
      provides: "Sphinx configuration with Furo theme, autodoc, napoleon, intersphinx, mermaid"
      contains: "furo"
    - path: ".readthedocs.yaml"
      provides: "ReadTheDocs build configuration"
      contains: "sphinx"
    - path: "docs/index.rst"
      provides: "Root toctree linking all documentation sections"
    - path: "docs/installation.rst"
      provides: "Platform-specific installation guide"
      contains: "pytorch.org"
  key_links:
    - from: ".readthedocs.yaml"
      to: "docs/conf.py"
      via: "sphinx configuration path"
      pattern: "docs/conf.py"
    - from: "pyproject.toml"
      to: "docs/conf.py"
      via: "dev dependencies include furo, sphinxcontrib-mermaid"
      pattern: "furo"
---

<objective>
Set up modern Sphinx documentation infrastructure with Furo theme and create the installation guide.

Purpose: Establish the docs build system that all other documentation plans depend on. Migrate from sphinx_rtd_theme to Furo per user decision. Create .readthedocs.yaml for hosted docs. Write the installation guide covering all platforms.

Output: Working Sphinx build with Furo theme, ReadTheDocs config, installation documentation.
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/conf.py
@pyproject.toml
@INSTALL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Sphinx config to Furo and create ReadTheDocs config</name>
  <files>docs/conf.py, .readthedocs.yaml, pyproject.toml, docs/index.rst</files>
  <action>
1. Update `docs/conf.py`:
   - Change `html_theme` from `"sphinx_rtd_theme"` to `"furo"`
   - Add `"sphinxcontrib.mermaid"` and `"sphinx.ext.viewcode"` to extensions (viewcode already present, just verify)
   - Add `"myst_parser"` to extensions for markdown support (needed for CLI guide in Plan 04)
   - Add `source_suffix` mapping: `{".rst": "restructuredtext", ".md": "markdown"}`
   - Set `autodoc_member_order = "bysource"` for logical ordering
   - Update copyright year to 2024-2025
   - Add `html_title = "AquaMVS"` for Furo sidebar
   - Keep existing intersphinx_mapping, napoleon_google_docstrings, autodoc_typehints settings

2. Update `pyproject.toml` `[project.optional-dependencies] dev`:
   - Replace `"sphinx-rtd-theme"` with `"furo"`, `"sphinxcontrib-mermaid"`, `"myst-parser"`

3. Create `.readthedocs.yaml` at project root:
   ```yaml
   version: 2
   build:
     os: ubuntu-24.04
     tools:
       python: "3.12"
   sphinx:
     configuration: docs/conf.py
     fail_on_warning: true
   python:
     install:
       - method: pip
         path: .
         extra_requirements:
           - dev
   ```
   Note: ReadTheDocs will need PyTorch and git prerequisites. Add a `build.commands` section that installs torch CPU and requirements-prereqs.txt before the pip install step:
   ```yaml
   build:
     os: ubuntu-24.04
     tools:
       python: "3.12"
     commands:
       - pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu
       - pip install -r requirements-prereqs.txt
       - pip install -e ".[dev]"
       - sphinx-build -W -b html docs/ $READTHEDOCS_OUTPUT/html
   ```
   (When using `build.commands`, omit the `sphinx:` and `python:` top-level keys — they conflict.)

4. Update `docs/index.rst` toctree to include planned sections:
   ```rst
   AquaMVS
   =======

   Multi-view stereo reconstruction of underwater surfaces viewed through
   a flat water surface, with Snell's law refraction modeling.

   .. toctree::
      :maxdepth: 2
      :caption: Getting Started

      installation

   .. toctree::
      :maxdepth: 2
      :caption: User Guide

      tutorial/index
      cli_guide

   .. toctree::
      :maxdepth: 2
      :caption: Theory

      theory/index

   .. toctree::
      :maxdepth: 2
      :caption: API Reference

      api/index

   Indices and tables
   ==================

   * :ref:`genindex`
   * :ref:`modindex`
   * :ref:`search`
   ```

5. Update `.github/workflows/docs.yml` to install furo and mermaid instead of sphinx-rtd-theme (it uses `pip install -e ".[dev]"` so this should be automatic from pyproject.toml change, but verify the workflow still works conceptually).
  </action>
  <verify>Run `pip install -e ".[dev]"` then `sphinx-build -W -b html docs/ docs/_build/html` — should succeed with only warnings about missing toctree targets (tutorial/index, cli_guide, theory/index, api/index which will be created in later plans). Create placeholder stubs for those missing targets so the build passes cleanly: empty .rst files with just a title.</verify>
  <done>Sphinx builds with Furo theme, .readthedocs.yaml exists, pyproject.toml has correct doc deps, index.rst has complete toctree structure</done>
</task>

<task type="auto">
  <name>Task 2: Write installation guide</name>
  <files>docs/installation.rst</files>
  <action>
Create `docs/installation.rst` with comprehensive platform-specific installation instructions. Structure:

1. **Prerequisites** section: Python 3.10+, pip, git

2. **Install PyTorch** section:
   - Link to pytorch.org/get-started/locally/ for their install selector
   - GPU (CUDA 12.1) example for both Windows and Linux
   - CPU-only example for both platforms
   - Note: "Choose the command matching your OS and GPU from pytorch.org"

3. **Install Git Prerequisites** section:
   - `pip install -r requirements-prereqs.txt` (quick method)
   - Manual install commands for LightGlue and RoMa v2
   - Brief note about why these aren't on PyPI

4. **Install AquaMVS** section:
   - PyPI install: `pip install aquamvs`
   - Development install: clone + `pip install -e ".[dev]"`

5. **Platform Notes** section:
   - **Windows**: Note about Visual C++ Build Tools sometimes needed for Open3D
   - **Linux**: Note about OpenGL libraries for Open3D visualization (`apt install libgl1-mesa-glx`)
   - **macOS**: Note about Apple Silicon PyTorch (MPS backend)

6. **Verify Installation** section:
   ```bash
   python -c "import aquamvs; print(aquamvs.__version__)"
   aquamvs --help
   ```

7. **Troubleshooting** section: Common errors (PyTorch not found, LightGlue not found, RoMa not found, CUDA version mismatch)

Keep content factual and concise. This is the brief installation guide per user decision — link to PyTorch's own install page for GPU setup details rather than duplicating their matrix.
  </action>
  <verify>Run `sphinx-build -W -b html docs/ docs/_build/html` — installation.rst renders without errors. Open `docs/_build/html/installation.html` and confirm all sections present.</verify>
  <done>Installation guide covers Windows, Linux, CPU-only, GPU configurations with troubleshooting section</done>
</task>

</tasks>

<verification>
1. `sphinx-build -W -b html docs/ docs/_build/html` completes without errors
2. `docs/_build/html/index.html` shows Furo theme (dark sidebar, clean typography)
3. `docs/_build/html/installation.html` exists with platform-specific instructions
4. `.readthedocs.yaml` exists at project root with correct build commands
5. `pyproject.toml` dev deps include furo, sphinxcontrib-mermaid, myst-parser (not sphinx-rtd-theme)
</verification>

<success_criteria>
- Sphinx builds cleanly with Furo theme
- ReadTheDocs config is ready for deployment
- Installation guide is comprehensive and platform-aware
- Doc structure has placeholder stubs for all planned sections
</success_criteria>

<output>
After completion, create `.planning/phases/04-documentation-and-examples/04-01-SUMMARY.md`
</output>
